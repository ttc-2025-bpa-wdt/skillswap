generator client {
    provider = "prisma-client"
    output   = "./gen/prisma"
}

datasource db {
    provider = "postgresql"
}

enum UserRole {
    STUDENT
    TEACHER
}

model User {
    id        Int      @id @default(autoincrement())
    handle    String   @unique
    email     String   @unique
    password  String

    firstName String
    lastName  String
    primaryRole UserRole @default(STUDENT)

    studentProfile StudentProfile?
    teacherProfile TeacherProfile?

    groups    GroupMember[]
    
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model StudentProfile {
    id        Int      @id @default(autoincrement())
    user      User     @relation(fields: [userId], references: [id])
    userId    Int      @unique

    bio       String?
    avatarUrl String?

    skillsOffered String[]
    skillsSought  String[]

    tags      String[]
    badges    String[]

    sessionsAttending SessionAttendee[]
    reviewsWritten    Review[]
}

model TeacherProfile {
    id        Int      @id @default(autoincrement())
    user      User     @relation(fields: [userId], references: [id])
    userId    Int      @unique

    bio       String?
    avatarUrl String?

    rating    Float    @default(0.0)
    reviews   Review[]

    tags      String[]
    badges    String[]

    sessionsHosted Session[]
}

model Session {
    id          Int      @id @default(autoincrement())
    
    host        TeacherProfile @relation(fields: [hostId], references: [id])
    hostId      Int

    attendees   SessionAttendee[]

    title       String
    description String
    meetingDate DateTime
    skillset    String[] 

    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
}

model SessionAttendee {
    session   Session @relation(fields: [sessionId], references: [id])
    sessionId Int
    
    student   StudentProfile @relation(fields: [studentId], references: [id])
    studentId Int

    joinedAt  DateTime @default(now())

    @@id([sessionId, studentId])
}

model Review {
    id        Int      @id @default(autoincrement())
    
    teacher   TeacherProfile @relation(fields: [teacherId], references: [id])
    teacherId Int
    
    student   StudentProfile @relation(fields: [studentId], references: [id])
    studentId Int

    rating    Int // 1-5 stars?
    comment   String?
    
    createdAt DateTime @default(now())
}

model Group {
    id          Int      @id @default(autoincrement())
    // "Groups dictate organizations or clubs in schools"
    name        String
    description String?
    
    members     GroupMember[]
    
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
}

enum GroupRole {
    MEMBER
    ADMIN
}

model GroupMember {
    group     Group @relation(fields: [groupId], references: [id])
    groupId   Int
    
    user      User  @relation(fields: [userId], references: [id])
    userId    Int
    
    role      GroupRole @default(MEMBER)
    
    joinedAt  DateTime @default(now())

    @@id([groupId, userId])
}
