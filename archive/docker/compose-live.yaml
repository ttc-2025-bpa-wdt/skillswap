name: "skillswap"
services:
  backend:
    build:
      context: ./project/backend
      dockerfile: ./docker/Dockerfile
    hostname: backend.skillswap.internal
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    hostname: ${HOST:-skillswap.internal}
    environment:
      - HOST=${HOST:-skillswap.internal}
    volumes:
      - ./project/nginx/hosts/live.conf.template:/etc/nginx/conf.d/hosts/live.conf:ro
      - ./project/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "${HOST_PORT:-80}:80"
    command: ["/bin/sh", "-c", "envsubst '$$HOST' < /etc/nginx/conf.d/hosts/live.conf > /etc/nginx/conf.d/hosts/live.conf && nginx -g 'daemon off;'"]
    restart: unless-stopped
